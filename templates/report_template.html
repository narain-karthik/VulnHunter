<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAPT Assessment Report - {{ report_data.metadata.target }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            padding: 40px 0;
            border-bottom: 3px solid #2c3e50;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
        }

        .metadata {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .metadata-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #bdc3c7;
        }

        .metadata-label {
            font-weight: bold;
            color: #2c3e50;
        }

        .metadata-value {
            color: #34495e;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            background-color: #3498db;
            color: white;
            padding: 15px 20px;
            font-size: 1.4em;
            border-radius: 8px 8px 0 0;
            margin-bottom: 0;
        }

        .section-content {
            background-color: white;
            border: 1px solid #3498db;
            border-top: none;
            padding: 20px;
            border-radius: 0 0 8px 8px;
        }

        .executive-summary {
            background-color: #f8f9fa;
            border-left: 5px solid #e74c3c;
            padding: 20px;
            margin-bottom: 30px;
        }

        .risk-level {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 15px;
        }

        .risk-critical { background-color: #e74c3c; color: white; }
        .risk-high { background-color: #e67e22; color: white; }
        .risk-medium { background-color: #f39c12; color: white; }
        .risk-low { background-color: #27ae60; color: white; }
        .risk-unknown { background-color: #95a5a6; color: white; }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            color: #7f8c8d;
            margin-top: 10px;
        }

        .vulnerability-list {
            list-style: none;
        }

        .vulnerability-item {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 0 8px 8px 0;
        }

        .vulnerability-item.critical { border-color: #e74c3c; }
        .vulnerability-item.high { border-color: #e67e22; }
        .vulnerability-item.medium { border-color: #f39c12; }
        .vulnerability-item.low { border-color: #27ae60; }

        .vulnerability-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .vulnerability-title {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .vulnerability-severity {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .vulnerability-description {
            color: #555;
            margin-bottom: 10px;
        }

        .vulnerability-details {
            font-size: 0.9em;
            color: #666;
        }

        .recommendations-list {
            list-style: none;
        }

        .recommendation-item {
            background-color: #e8f5e8;
            border-left: 4px solid #27ae60;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 0 8px 8px 0;
        }

        .recommendation-title {
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 8px;
        }

        .recommendation-priority {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .priority-critical { background-color: #e74c3c; color: white; }
        .priority-high { background-color: #e67e22; color: white; }
        .priority-medium { background-color: #f39c12; color: white; }
        .priority-low { background-color: #27ae60; color: white; }

        .technical-details {
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            overflow-x: auto;
        }

        .technical-details pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            white-space: pre-wrap;
        }

        .tool-results {
            margin-bottom: 20px;
        }

        .tool-header {
            background-color: #34495e;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            border-radius: 4px 4px 0 0;
        }

        .tool-content {
            background-color: #f9f9f9;
            border: 1px solid #34495e;
            border-top: none;
            padding: 15px;
            border-radius: 0 0 4px 4px;
        }

        .chart-container {
            margin: 20px 0;
            text-align: center;
        }

        .chart-bar {
            display: inline-block;
            width: 60px;
            margin: 0 10px;
            text-align: center;
        }

        .chart-bar-fill {
            background-color: #3498db;
            border-radius: 4px 4px 0 0;
            margin-bottom: 5px;
        }

        .chart-label {
            font-size: 0.8em;
            color: #666;
        }

        .methodology-list {
            list-style-type: decimal;
            padding-left: 30px;
        }

        .methodology-list li {
            margin-bottom: 10px;
        }

        .footer {
            border-top: 2px solid #2c3e50;
            padding-top: 20px;
            margin-top: 40px;
            text-align: center;
            color: #7f8c8d;
        }

        .print-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .print-button:hover {
            background-color: #2980b9;
        }

        @media print {
            .print-button { display: none; }
            .container { box-shadow: none; }
            body { background-color: white; }
        }

        @media (max-width: 768px) {
            .metadata-grid {
                grid-template-columns: 1fr;
            }
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            .vulnerability-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <button class="print-button" onclick="window.print()">Print Report</button>
    
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Vulnerability Assessment & Penetration Testing Report</h1>
            <p>{{ report_data.metadata.assessment_type.upper() }} Security Assessment</p>
        </div>

        <!-- Assessment Metadata -->
        <div class="metadata">
            <div class="metadata-grid">
                <div class="metadata-item">
                    <span class="metadata-label">Target:</span>
                    <span class="metadata-value">{{ report_data.metadata.target }}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Assessment Type:</span>
                    <span class="metadata-value">{{ report_data.metadata.assessment_type.upper() }}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Report Date:</span>
                    <span class="metadata-value">{{ report_data.metadata.report_date }}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Duration:</span>
                    <span class="metadata-value">{{ report_data.metadata.duration }}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Session ID:</span>
                    <span class="metadata-value">{{ session.id }}</span>
                </div>
                <div class="metadata-item">
                    <span class="metadata-label">Assessor:</span>
                    <span class="metadata-value">{{ report_data.metadata.assessor }}</span>
                </div>
            </div>
        </div>

        <!-- Executive Summary -->
        <div class="section">
            <h2 class="section-title">Executive Summary</h2>
            <div class="section-content">
                <div class="executive-summary">
                    <div class="risk-level risk-{{ report_data.executive_summary.overall_risk.lower() }}">
                        Overall Risk: {{ report_data.executive_summary.overall_risk }}
                    </div>
                    
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-number">{{ report_data.executive_summary.total_vulnerabilities }}</div>
                            <div class="stat-label">Total Vulnerabilities</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">{{ report_data.executive_summary.critical_issues }}</div>
                            <div class="stat-label">Critical Issues</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">{{ report_data.executive_summary.high_risk_issues }}</div>
                            <div class="stat-label">High Risk Issues</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">{{ report_data.findings.risks.medium + report_data.findings.risks.low }}</div>
                            <div class="stat-label">Medium/Low Issues</div>
                        </div>
                    </div>

                    <h3>Business Impact</h3>
                    <p>{{ report_data.executive_summary.business_impact }}</p>

                    {% if report_data.executive_summary.immediate_actions %}
                    <h3>Immediate Actions Required</h3>
                    <ul>
                    {% for action in report_data.executive_summary.immediate_actions %}
                        <li>{{ action }}</li>
                    {% endfor %}
                    </ul>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Methodology -->
        {% if report_data.methodology %}
        <div class="section">
            <h2 class="section-title">Assessment Methodology</h2>
            <div class="section-content">
                <p><strong>Framework:</strong> {{ report_data.methodology.methodology }}</p>
                
                {% if report_data.methodology.objectives %}
                <h3>Assessment Objectives</h3>
                <ul class="methodology-list">
                {% for objective in report_data.methodology.objectives %}
                    <li>{{ objective }}</li>
                {% endfor %}
                </ul>
                {% endif %}

                {% if report_data.methodology.scope %}
                <h3>Scope Definition</h3>
                <p><strong>Target:</strong> {{ report_data.methodology.scope.target }}</p>
                
                {% if report_data.methodology.scope.inclusions %}
                <p><strong>Inclusions:</strong></p>
                <ul>
                {% for inclusion in report_data.methodology.scope.inclusions %}
                    <li>{{ inclusion }}</li>
                {% endfor %}
                </ul>
                {% endif %}

                {% if report_data.methodology.scope.exclusions %}
                <p><strong>Exclusions:</strong></p>
                <ul>
                {% for exclusion in report_data.methodology.scope.exclusions %}
                    <li>{{ exclusion }}</li>
                {% endfor %}
                </ul>
                {% endif %}
                {% endif %}

                {% if report_data.methodology.tools_used %}
                <h3>Tools Used</h3>
                <p>{{ ', '.join(report_data.methodology.tools_used) }}</p>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Vulnerability Findings -->
        {% if report_data.findings.vulnerabilities %}
        <div class="section">
            <h2 class="section-title">Vulnerability Findings</h2>
            <div class="section-content">
                <!-- Vulnerability Statistics Chart -->
                <div class="chart-container">
                    <h3>Vulnerabilities by Severity</h3>
                    {% set max_count = [report_data.findings.risks.critical, report_data.findings.risks.high, report_data.findings.risks.medium, report_data.findings.risks.low] | max %}
                    
                    <div class="chart-bar">
                        <div class="chart-bar-fill" style="height: {{ (report_data.findings.risks.critical / max_count * 100) if max_count > 0 else 0 }}px; background-color: #e74c3c;"></div>
                        <div class="chart-label">Critical<br>{{ report_data.findings.risks.critical }}</div>
                    </div>
                    <div class="chart-bar">
                        <div class="chart-bar-fill" style="height: {{ (report_data.findings.risks.high / max_count * 100) if max_count > 0 else 0 }}px; background-color: #e67e22;"></div>
                        <div class="chart-label">High<br>{{ report_data.findings.risks.high }}</div>
                    </div>
                    <div class="chart-bar">
                        <div class="chart-bar-fill" style="height: {{ (report_data.findings.risks.medium / max_count * 100) if max_count > 0 else 0 }}px; background-color: #f39c12;"></div>
                        <div class="chart-label">Medium<br>{{ report_data.findings.risks.medium }}</div>
                    </div>
                    <div class="chart-bar">
                        <div class="chart-bar-fill" style="height: {{ (report_data.findings.risks.low / max_count * 100) if max_count > 0 else 0 }}px; background-color: #27ae60;"></div>
                        <div class="chart-label">Low<br>{{ report_data.findings.risks.low }}</div>
                    </div>
                </div>

                <!-- Detailed Vulnerability List -->
                <ul class="vulnerability-list">
                {% for vulnerability in report_data.findings.vulnerabilities %}
                    <li class="vulnerability-item {{ vulnerability.severity.lower() }}">
                        <div class="vulnerability-header">
                            <span class="vulnerability-title">{{ vulnerability.type }}</span>
                            <span class="vulnerability-severity risk-{{ vulnerability.severity.lower() }}">
                                {{ vulnerability.severity }}
                            </span>
                        </div>
                        
                        <div class="vulnerability-description">
                            {{ vulnerability.description }}
                        </div>
                        
                        <div class="vulnerability-details">
                            {% if vulnerability.location %}
                            <strong>Location:</strong> {{ vulnerability.location }}<br>
                            {% endif %}
                            {% if vulnerability.tool %}
                            <strong>Detected by:</strong> {{ vulnerability.tool }}<br>
                            {% endif %}
                            {% if vulnerability.target %}
                            <strong>Target:</strong> {{ vulnerability.target }}
                            {% endif %}
                        </div>

                        {% if detailed and vulnerability.tool_output %}
                        <div class="technical-details">
                            <strong>Technical Details:</strong>
                            <pre>{{ vulnerability.tool_output[:500] }}{% if vulnerability.tool_output|length > 500 %}...{% endif %}</pre>
                        </div>
                        {% endif %}
                    </li>
                {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}

        <!-- Successful Exploits -->
        {% if report_data.findings.exploits %}
        <div class="section">
            <h2 class="section-title">Successful Exploits</h2>
            <div class="section-content">
                {% for exploit in report_data.findings.exploits %}
                <div class="vulnerability-item high">
                    <div class="vulnerability-header">
                        <span class="vulnerability-title">{{ exploit.exploit_name }}</span>
                        <span class="vulnerability-severity risk-high">EXPLOITED</span>
                    </div>
                    
                    <div class="vulnerability-description">
                        <strong>Exploit Type:</strong> {{ exploit.exploit_type }}<br>
                        <strong>Target:</strong> {{ exploit.target }}<br>
                        <strong>Status:</strong> {{ exploit.status|upper }}
                    </div>

                    {% if exploit.evidence %}
                    <div class="vulnerability-details">
                        <strong>Evidence:</strong>
                        <ul>
                        {% for evidence in exploit.evidence %}
                            <li>{{ evidence }}</li>
                        {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    {% if detailed and exploit.output %}
                    <div class="technical-details">
                        <strong>Exploit Output:</strong>
                        <pre>{{ exploit.output[:500] }}{% if exploit.output|length > 500 %}...{% endif %}</pre>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Recommendations -->
        {% if report_data.recommendations %}
        <div class="section">
            <h2 class="section-title">Security Recommendations</h2>
            <div class="section-content">
                <ul class="recommendations-list">
                {% for recommendation in report_data.recommendations %}
                    <li class="recommendation-item">
                        <div class="recommendation-title">{{ recommendation.title }}</div>
                        <div class="recommendation-priority priority-{{ recommendation.priority.lower() }}">
                            {{ recommendation.priority }} Priority
                        </div>
                        
                        {% if recommendation.issue %}
                        <p><strong>Issue:</strong> {{ recommendation.issue }}</p>
                        {% endif %}
                        
                        <p><strong>Recommendation:</strong> {{ recommendation.description }}</p>
                        
                        {% if recommendation.effort %}
                        <p><strong>Effort Required:</strong> {{ recommendation.effort }}</p>
                        {% endif %}
                        
                        {% if recommendation.timeline %}
                        <p><strong>Timeline:</strong> {{ recommendation.timeline }}</p>
                        {% endif %}
                    </li>
                {% endfor %}
                </ul>
            </div>
        </div>
        {% endif %}

        <!-- Technical Details -->
        {% if detailed and report_data.technical_details %}
        <div class="section">
            <h2 class="section-title">Technical Details</h2>
            <div class="section-content">
                
                <!-- Reconnaissance Results -->
                {% if report_data.technical_details.reconnaissance %}
                <h3>Reconnaissance Phase</h3>
                
                {% if report_data.technical_details.reconnaissance.assets_discovered %}
                <h4>Discovered Assets</h4>
                <ul>
                {% for asset in report_data.technical_details.reconnaissance.assets_discovered %}
                    <li>{{ asset }}</li>
                {% endfor %}
                </ul>
                {% endif %}
                {% endif %}

                <!-- Vulnerability Assessment Results -->
                {% if report_data.technical_details.vulnerability_assessment %}
                <h3>Vulnerability Assessment Results</h3>
                {% for tool_name, tool_results in report_data.technical_details.vulnerability_assessment.items() %}
                <div class="tool-results">
                    <div class="tool-header">{{ tool_name|upper }} Results</div>
                    <div class="tool-content">
                        <p><strong>Status:</strong> {{ tool_results.status|upper }}</p>
                        {% if tool_results.start_time %}
                        <p><strong>Execution Time:</strong> {{ tool_results.start_time }}</p>
                        {% endif %}
                        {% if tool_results.vulnerabilities_found %}
                        <p><strong>Vulnerabilities Found:</strong> {{ tool_results.vulnerabilities_found|length }}</p>
                        {% endif %}
                        {% if tool_results.error %}
                        <p><strong>Error:</strong> {{ tool_results.error }}</p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
                {% endif %}

                <!-- Penetration Testing Results -->
                {% if report_data.technical_details.penetration_testing %}
                <h3>Penetration Testing Results</h3>
                
                {% set pt_results = report_data.technical_details.penetration_testing %}
                <p><strong>Exploits Attempted:</strong> {{ pt_results.exploits_attempted|length }}</p>
                <p><strong>Successful Exploits:</strong> {{ pt_results.successful_exploits|length }}</p>

                {% if pt_results.post_exploitation.activities %}
                <h4>Post-Exploitation Activities</h4>
                <ul>
                {% for activity in pt_results.post_exploitation.activities %}
                    <li>{{ activity }}</li>
                {% endfor %}
                </ul>
                {% endif %}
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Appendices -->
        <div class="section">
            <h2 class="section-title">Appendices</h2>
            <div class="section-content">
                <h3>Assessment Coverage</h3>
                <p>This assessment covered the following areas based on the {{ report_data.metadata.assessment_type }} methodology:</p>
                
                {% if session.phases_completed %}
                <h4>Completed Phases</h4>
                <ul>
                {% for phase in session.phases_completed %}
                    <li>{{ phase.replace('_', ' ').title() }}</li>
                {% endfor %}
                </ul>
                {% endif %}

                <h3>Risk Rating Methodology</h3>
                <div class="technical-details">
                    <p><strong>Critical:</strong> Vulnerabilities that provide immediate access to sensitive data or systems, or allow complete system compromise.</p>
                    <p><strong>High:</strong> Vulnerabilities that could lead to significant data exposure or system compromise with minimal additional effort.</p>
                    <p><strong>Medium:</strong> Vulnerabilities that require additional steps to exploit but could lead to data exposure or system compromise.</p>
                    <p><strong>Low:</strong> Vulnerabilities that have minimal impact on security or require significant additional vulnerabilities to exploit.</p>
                </div>

                <h3>Disclaimer</h3>
                <div class="technical-details">
                    <p>This assessment was performed using automated tools and techniques. The results represent the security posture at the time of testing. Security is an ongoing process, and regular assessments are recommended to maintain adequate security levels.</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Generated by VAPT Automated Tool v1.0</p>
            <p>Report generated on {{ report_data.metadata.report_date }}</p>
            <p>This report contains confidential information and should be handled according to your organization's data classification policy.</p>
        </div>
    </div>

    <script>
        // Add some basic interactivity
        document.addEventListener('DOMContentLoaded', function() {
            // Smooth scrolling for any internal links
            const links = document.querySelectorAll('a[href^="#"]');
            for (let link of links) {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            }

            // Add click-to-expand functionality for technical details
            const technicalDetails = document.querySelectorAll('.technical-details');
            for (let detail of technicalDetails) {
                const pre = detail.querySelector('pre');
                if (pre && pre.textContent.length > 500) {
                    detail.style.cursor = 'pointer';
                    detail.title = 'Click to expand/collapse';
                    
                    detail.addEventListener('click', function() {
                        if (this.classList.contains('expanded')) {
                            this.classList.remove('expanded');
                            pre.style.maxHeight = '200px';
                            pre.style.overflow = 'hidden';
                        } else {
                            this.classList.add('expanded');
                            pre.style.maxHeight = 'none';
                            pre.style.overflow = 'visible';
                        }
                    });
                    
                    // Initially collapse long content
                    pre.style.maxHeight = '200px';
                    pre.style.overflow = 'hidden';
                }
            }
        });
    </script>
</body>
</html>
